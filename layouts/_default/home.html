{{ define "main" }}
  <h1>{{ .Title }}</h1>
  {{ with .Params.details }}
    <p>Details: <a href="{{ . }}">{{ . }}</a></p>
  {{ end }}
  {{ with .Params.description }}
    <p>Description: {{ . }}</p>
  {{ end }}
  {{ with or .Params.url .Params.details }}
    <hr>
  {{ end }}

  {{/*
  Build a map of pages. For each element:
  - The key is the first letter of the title (lowercase)
  - The value is a slice of related pages
  */}}
  {{ $mp := dict }}
  {{ range $p := where (where site.RegularPages "Section" "fruits") "Params.has_picture" "Y" }}
    {{ $firstLetter := strings.ToLower (strings.Substr $p.Title 0 1) }}
    {{ with index $mp $firstLetter }}
      {{ $mp = merge $mp (dict $firstLetter (append . (slice $p))) }}
    {{ else }}
      {{ $mp = merge $mp (dict $firstLetter (slice $p)) }}
    {{ end }}
  {{ end }}

  {{/* Display links to the pages, grouped by the first letter with count. */}}
  {{ range $firstLetter, $pages := $mp }}
    <h2>{{ strings.FirstUpper $firstLetter }} ({{ len $pages }})</h2>
    {{ range $pages.ByTitle }}
      <a href="{{ .RelPermalink }}">{{ .LinkTitle }}</a><br>
    {{ end }}
  {{ end }}

{{ end }}
