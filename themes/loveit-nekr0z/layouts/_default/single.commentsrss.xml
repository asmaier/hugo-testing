{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
{{- $comment := .Scratch.Get "comment" | default dict -}}
{{- if $comment.enable -}}
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>
            {{- T "comment_rss" | humanize -}}
        </title>
        <link>
            {{- .Permalink -}}
        </link>
        <description>{{ .Title }} {{ T "on" }} {{ .Site.Title }} - {{ T "comment_rss" | humanize }}</description>
        <generator>Hugo -- gohugo.io</generator>
        {{- with .Language.Lang -}}
            <language>
                {{- . -}}
            </language>
        {{- end -}}
        {{- with .Site.Author.email -}}
            <managingEditor>
                {{- . }}{{ with $.Site.Author.name }} ({{ . }}){{ end -}}
            </managingEditor>
            <webMaster>
                {{- . }}{{ with $.Site.Author.name }} ({{ . }}){{ end -}}
            </webMaster>
        {{- end -}}
        {{- with .Site.Copyright -}}
            <copyright>
                {{- . -}}
            </copyright>
        {{- end -}}
        {{- if not .Date.IsZero -}}
            <lastBuildDate>
                {{- .Date.Format "Mon, 02 Jan 2006 15:04:05 -0700" -}}
            </lastBuildDate>
        {{- end -}}
        {{ with .OutputFormats.Get "commentsRSS" }}
            {{ printf "<atom:link href=%q rel=\"self\" type=%q />" .Permalink .MediaType | safeHTML }}
        {{ end }}
    {{- range $.Site.Params.websubHub -}}
    <atom:link href="{{ . }}" rel="hub" />
    {{ end }}
    {{- $wmsjson := .Resources.GetMatch "webmentions.json" -}}
	{{- with $wmsjson -}}{{- $wms := . | unmarshal }}
	{{- if reflect.IsMap $wms -}}{{- $wms = index $wms "children" -}}{{- end -}}
        {{- range $wms -}}
        {{- if reflect.IsMap . -}}
            {{- partial "rss/comment.html" . -}}
        {{- end -}}
        {{- end -}}
    {{- end -}}
    </channel>
</rss>
{{- end -}}
